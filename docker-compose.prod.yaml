# Production stack
# Usage: docker compose -f docker-compose.prod.yaml --env-file .env.production up -d --build

services:
  app:
    build: .
    ports:
      - "80:80"
    volumes:
      - lastsignal_storage:/rails/storage
    environment:
      RAILS_ENV: production
      RAILS_MASTER_KEY: ${RAILS_MASTER_KEY}
      SECRET_KEY_BASE: ${SECRET_KEY_BASE}
      APP_BASE_URL: ${APP_BASE_URL}
      APP_HOST: ${APP_HOST}
      SMTP_HOST: ${SMTP_HOST}
      SMTP_PORT: ${SMTP_PORT}
      SMTP_USER: ${SMTP_USER}
      SMTP_PASS: ${SMTP_PASS}
      SMTP_DOMAIN: ${SMTP_DOMAIN}
      SMTP_FROM_EMAIL: ${SMTP_FROM_EMAIL}
      SMTP_FROM_NAME: ${SMTP_FROM_NAME:-LastSignal}
      ALLOWED_EMAILS: ${ALLOWED_EMAILS:-}
      PROCESS_CHECKINS_INTERVAL_MINUTES: ${PROCESS_CHECKINS_INTERVAL_MINUTES:-60}
      SOLID_QUEUE_IN_PUMA: "true"
    restart: unless-stopped

volumes:
  lastsignal_storage:
