# =============================================================================
# LastSignal Environment Variables
# =============================================================================
# Copy this file to .env and fill in your values.
# NEVER commit .env to version control!
# =============================================================================

# -----------------------------------------------------------------------------
# Application
# -----------------------------------------------------------------------------
# Base URL for link generation (include protocol)
APP_BASE_URL=http://localhost:3000

# Host for DNS rebinding protection and email links (no protocol)
APP_HOST=localhost

# Rails master key (required for production)
# Generate with: docker compose run --rm web bin/rails secret
RAILS_MASTER_KEY=your-rails-master-key-here

# Secret key base for session encryption (required for production)
# Generate with: docker compose run --rm web bin/rails secret
SECRET_KEY_BASE=your-secret-key-base-here

# -----------------------------------------------------------------------------
# Database
# -----------------------------------------------------------------------------
# For local development (without Docker):
DATABASE_URL=postgres://localhost:5432/lastsignal_development

# For Docker Compose (password for PostgreSQL container):
POSTGRES_PASSWORD=your-secure-postgres-password

# -----------------------------------------------------------------------------
# Redis (for Sidekiq + rate limiting)
# -----------------------------------------------------------------------------
REDIS_URL=redis://localhost:6379/0

# -----------------------------------------------------------------------------
# SMTP (Email)
# -----------------------------------------------------------------------------
SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_USER=your-smtp-user
SMTP_PASS=your-smtp-password
SMTP_DOMAIN=example.com
SMTP_FROM_EMAIL=noreply@lastsignal.app
SMTP_FROM_NAME=LastSignal

# -----------------------------------------------------------------------------
# Authentication
# -----------------------------------------------------------------------------
# Magic link expiration window in minutes
MAGIC_LINK_TTL_MINUTES=15

# Optional allowlist for private instances (comma-separated emails)
# When set, only these emails can request magic links.
ALLOWED_EMAILS=owner@example.com,admin@example.com

# -----------------------------------------------------------------------------
# Check-in Engine (defaults and bounds)
# -----------------------------------------------------------------------------
# Defaults (used when creating new users)
CHECKIN_DEFAULT_INTERVAL_HOURS=168
CHECKIN_DEFAULT_GRACE_HOURS=72
CHECKIN_DEFAULT_COOLDOWN_HOURS=48

# Minimum bounds (users cannot set lower than these)
CHECKIN_MIN_INTERVAL_HOURS=24
CHECKIN_MIN_GRACE_HOURS=24
CHECKIN_MIN_COOLDOWN_HOURS=24

# Maximum bounds (users cannot set higher than these)
CHECKIN_MAX_INTERVAL_HOURS=8760
CHECKIN_MAX_GRACE_HOURS=720
CHECKIN_MAX_COOLDOWN_HOURS=720

# -----------------------------------------------------------------------------
# Rate Limiting
# -----------------------------------------------------------------------------
RATE_LIMIT_MAGIC_LINK_PER_IP=5
RATE_LIMIT_MAGIC_LINK_PERIOD=300

# -----------------------------------------------------------------------------
# Crypto (Argon2id KDF parameters)
# -----------------------------------------------------------------------------
# Client-side KDF parameters passed to the browser
# OPSLIMIT_MODERATE = 3, MEMLIMIT_MODERATE = 268435456 (256MB)
ARGON2ID_OPS_LIMIT=3
ARGON2ID_MEM_LIMIT=268435456

# -----------------------------------------------------------------------------
# Webhook (for email delivery tracking)
# -----------------------------------------------------------------------------
# Optional secret used to authenticate webhook calls
EMAIL_WEBHOOK_SECRET=your-webhook-secret-here

# -----------------------------------------------------------------------------
# Invite tokens
# -----------------------------------------------------------------------------
INVITE_TOKEN_TTL_DAYS=7

# -----------------------------------------------------------------------------
# Trusted contact defaults and bounds
# -----------------------------------------------------------------------------
TRUSTED_CONTACT_DEFAULT_PING_INTERVAL_HOURS=24
TRUSTED_CONTACT_DEFAULT_PAUSE_DURATION_HOURS=168
TRUSTED_CONTACT_MIN_PING_INTERVAL_HOURS=12
TRUSTED_CONTACT_MAX_PING_INTERVAL_HOURS=720
TRUSTED_CONTACT_MIN_PAUSE_DURATION_HOURS=24
TRUSTED_CONTACT_MAX_PAUSE_DURATION_HOURS=720
TRUSTED_CONTACT_TOKEN_TTL_HOURS=168
